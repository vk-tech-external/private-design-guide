# {heading(Автоматическая эвакуация ВМ)[id=design_ipmi_auto_evacuation]}

Начиная с версии {var(sys)} 4.2 в состав поставки входит Сервис автоматической эвакуации ВМ с недоступного гипервизора. Для корректной работы функций сервиса при проектировании инсталляции необходимо учитывать ряд требований.

## {heading(Принцип работы)[id=design_ipmi_work_principles]}

Сервис автоэвакуации контролирует сетевую доступность каждого гипервизора по сетям Management и Ceph External (Storage), а также доступность интерфейсов управления IPMI.

В случае потери доступности сетевых интерфейсов гипервизора, в течение заданного времени гипервизор будет признан недоступным, и будет запущена процедура его выключения через интерфейс IPMI. В случае недоступности интерфейса IPMI в течение заданного времени после попытки выключения гипервизор будет признан отключенным по питанию.

После отключения гипервизора или признания его отключенным, запускается процесс миграции (обычная миграция, не live) виртуальных машин на другие гипервизоры. Процесс выполняется штатно в соответствии с правилами размещения нагрузки через nova-scheduler.

## {heading(Ограничения)[id=design_ipmi_limitation]}

Для корректной работы автоэвакуации необходим доступ из сети Management к сети, в которой размещены интерфейсы IPMI. Требуется указание данных для доступа в IPMI — нужен пользователь с правами на управление питанием. Рекомендуется использование идентичных учетных данных на всех серверах.

Если доступ к интерфейсам IPMI отсутствует, служба автоэвакуации не сможет корректно работать. При ее возможном включении могут возникать сбои и повреждение данных из-за ложной недоступности гипервизора.

Необходимо ограничивать количество одновременно эвакуируемых узлов, чтобы избежать лавинообразного нарастания отказов и перегрузки других гипервизоров. 

<err>

Чтобы эвакуации выполнилась успешно, при проектировании {var(sys2)} должен быть заложен запас по количеству узлов. При нехватке ресурсов автоэвакуция выполнена не будет.

</err>

## {heading(Требования к проектированию)[id=design_ipmi_design_requirements]}

При проектировании {var(sys2)} необходимо указать:

1.	Будет ли активирована служба автоэвакуации.
2.	Адреса интерфейсов IPMI для всех серверов инсталляции и указать учетные данные для управления питанием.
3.	Необходимость доступа к сети с интерфейсами IPMI.
4.	Таймауты для миграции и признания сервера отключенным.
5.	Предельное количество узлов для одновременной миграции.
